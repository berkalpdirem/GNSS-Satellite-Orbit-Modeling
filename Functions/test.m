
% 
calculation_epoch=(2+1+4+3+1+7+0+6)*660;
year=2020;
mounth=4;
day=1;
sec=calculation_epoch;
%% 

%Mersin Station approximate coordinates:
R0rcv=[4239146.6414;2886967.1245;3778874.4800];

%Alpha and Beta from navigation message:
ION_ALPHA=[0.1118D-07  0.7451D-08 -0.5960D-07 -0.5960D-07];    
ION_BETA =[0.9011D+05  0.1638D+05 -0.1966D+06 -0.6554D+05];

%My Satallites:G04,G05,G07,G08,G09,G13,G27,G28,G30 Also them C1 measurements:
Prn_c1=[02 24533411.755;
        03 25200844.492;
        04 22708760.005;
        05 23780174.106;
        06 24054334.406;
        07 20740265.876;
        08 25321581.015
        09 20768713.637
        16 24300447.797
        27 25387812.627;
        28 24436624.899;
        30 21708694.078];
    
 %%  
%Clock corrections with their related epochs(06.00)
RC02=[14400 -0.431794673204D-03 -0.659383658785D-11 0.000000000000D+00];
RC03=[14400 -0.133152585477D-03 -0.104591890704D-10 0.000000000000D+00];
RC04=[14400 -0.700796954334D-04 -0.522959453519D-11 0.000000000000D+00];
RC05=[14400 -0.100787729025D-04 -0.682121026330D-12 0.000000000000D+00];
RC06=[14400 -0.243368092924D-03 -0.807176547823D-11 0.000000000000D+00];
RC07=[14400 -0.248546246439D-03 -0.852651282912D-11 0.000000000000D+00];
RC08=[14400 -0.291061587632D-04 -0.136424205266D-11 0.000000000000D+00];
RC09=[14400 -0.188551377505D-03 -0.795807864051D-11 0.000000000000D+00];
RC16=[14368 -0.141466967762D-03 -0.432009983342D-11 0.000000000000D+00];
RC27=[14400 -0.254467129707D-03 -0.105728759081D-10 0.000000000000D+00];
RC28=[14400  0.728746410459D-03 -0.284217094304D-11 0.000000000000D+00];
RC30=[14400 -0.188334379345D-03 -0.852651282912D-11 0.000000000000D+00];

Relatedepoch_Clockcorrections={RC02 RC03 RC04 RC05 RC06 RC07 RC08 RC09 RC16 RC27 RC28 RC30};

%Satallite parameters from navigation message
G02=[0.800000000000D+02 -0.686250000000D+02 0.457876215239D-08 -0.213249742209D+01;
   -0.329501926899D-05 0.197792183608D-01 0.596977770328D-05 0.515366853142D+04;
    0.273600000000D+06 0.234693288803D-06 -0.228263241237D+01 0.162050127983D-06;
    0.958442519549D+00 0.256718750000D+03 -0.164085401508D+01 -0.785747015231D-08;
    0.155720772110D-09 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 -0.176951289177D-07 0.800000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];

G03=[0.260000000000D+02 -0.373125000000D+02 0.440625496678D-08 0.282494899316D+01;
   -0.203028321266D-05 0.270608335268D-02 0.861845910549D-05 0.515358676529D+04;
    0.273600000000D+06 -0.242143869400D-07 -0.116633589869D+01 -0.651925802231D-07;
    0.964988321625D+00 0.213656250000D+03 0.696727581135D+0 0-0.784175521201D-08;
    0.171078554680D-09 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 0.186264514923D-08 0.260000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];

G04=[0.219000000000D+03 0.250000000000D+01 0.464233622908D-08 -0.123477857954D+01;
    0.130385160446D-07 0.649683992378D-03 0.764802098274D-05 0.515369952393D+04;
    0.273600000000D+06 -0.186264514923D-08 -0.877210635801D-01 -0.745058059692D-08;
    0.960339659510D+00 0.232468750000D+03 -0.263949056874D+01 -0.799211861811D-08;
   -0.703600736366D-10 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 -0.419095158577D-08 0.219000000000D+03;
    0.266538000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];

G05=[0.730000000000D+02 -0.375937500000D+02 0.484698761077D-08 0.529481903092D+00;
   -0.171363353729D-05 0.579938711598D-02 0.886432826519D-05 0.515363016891D+04;
    0.273600000000D+06 -0.502914190292D-07 -0.119745547535D+01 0.633299350738D-07;
    0.951874055409D+00 0.202093750000D+03 0.786458746821D+00 -0.819927010394D-08;
    0.157149403046D-09 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 -0.111758708954D-07 0.730000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
     
G06=[0.500000000000D+02 -0.686875000000D+02 0.423946230491D-08 -0.224560287780D+01;
   -0.349991023541D-05 0.194012641441D-02 0.703148543835D-05 0.515377979088D+04;
    0.273600000000D+06 -0.372529029846D-07 -0.221575214558D+01 0.409781932831D-07;
    0.978965462275D+00 0.253875000000D+03 -0.106860399306D+01 -0.787925677410D-08;
    0.692886004340D-10 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 0.465661287308D-08 0.500000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
     
G07=[0.112000000000D+03 0.302500000000D+02 0.451411660250D-08 -0.313642454145D+01
    0.144354999065D-05 0.135289962636D-01 0.878423452377D-05 0.515368140602D+04
    0.273600000000D+06 -0.260770320892D-07 0.938926159552D+00 -0.130385160446D-06
    0.953540055777D+00 0.205656250000D+03 -0.241018073747D+01 -0.778639576321D-08
   -0.231795369493D-09 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00
    0.200000000000D+01 0.000000000000D+00 -0.111758708954D-07 0.112000000000D+03
    0.267762000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
 
G08=[0.110000000000D+02 0.140625000000D+02 0.444554231754D-08 -0.765342211918D-01;
    0.780448317528D-06 0.531659473199D-02 0.407733023167D-05 0.515364564133D+04;
    0.273600000000D+06 0.316649675369D-07 0.300677238361D+01 0.204890966415D-07;
    0.970103642905D+00 0.303000000000D+03 -0.123660839748D+00 -0.827570185906D-08;
    0.110004582132D-09 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 0.512227416039D-08 0.110000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
 
G09=[0.540000000000D+02 0.103125000000D+01 0.485948813147D-08 0.119694639156D+00;
   -0.149011611938D-07 0.161791814025D-02 0.752508640289D-05 0.515375764465D+04;
    0.273600000000D+06 -0.186264514923D-07 -0.135169433412D+00 0.167638063431D-07;
    0.953029863096D+00 0.229718750000D+03 0.180170591018D+01 -0.814962517889D-08;
   -0.428589281035D-10 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 0.139698386192D-08 0.540000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
 
G16=[0.470000000000D+02 0.770937500000D+02 0.393552107311D-08 0.639014649525D+00;
    0.412762165070D-05 0.115263178013D-01 0.740960240364D-05 0.515374226189D+04;
    0.273568000000D+06 -0.108033418655D-06 0.206354096002D+01 0.188127160072D-06;
    0.979044579811D+00 0.245937500000D+03 0.620133920118D+00 -0.795533137148D-08;
   -0.442875590403D-10 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 -0.107102096081D-07 0.470000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
 
G27=[0.890000000000D+02 0.128437500000D+02 0.430517932800D-08 -0.246858022239D+00;
    0.784173607826D-06 0.812588725239D-02 0.399537384510D-05 0.515366077232D+04;
    0.273600000000D+06 0.316649675369D-07 0.302060088301D+01 0.130385160446D-06;
    0.978513678062D+00 0.312000000000D+03 0.528842332863D+00 -0.824141471657D-08;
    0.950039572962D-10 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 0.139698386192D-08 0.890000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
 
G28=[0.140000000000D+02 0.566875000000D+02 0.410195657724D-08 0.479655328781D+00;
    0.294856727123D-05 0.185006565880D-01 0.687129795551D-05 0.515367000771D+04;
    0.273600000000D+06 -0.201165676117D-06 0.206730951745D+01 -0.167638063431D-06;
    0.978055486268D+00 0.258125000000D+03 -0.141129002228D+01 -0.825927260328D-08;
   -0.346443002170D-10 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 -0.111758708954D-07 0.140000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
 
G30=[0.520000000000D+02 0.354062500000D+02 0.492627662777D-08 0.313635075917D+01;
    0.179931521416D-05 0.441727566067D-02 0.835768878460D-05 0.515367037964D+04;
    0.273600000000D+06 -0.447034835815D-07 0.962446889136D+00 0.558793544769D-08;
    0.938861440056D+00 0.207125000000D+03 -0.291656867637D+01 -0.814426781287D-08;
   -0.264296723305D-09 0.100000000000D+01 0.209900000000D+04 0.000000000000D+00;
    0.200000000000D+01 0.000000000000D+00 0.372529029846D-08 0.520000000000D+02;
    0.266418000000D+06 0.400000000000D+01 0.000000000000D+00 0.000000000000D+00];
%%---------------------------------------------------------------------------------------------------------------------------------------------------------
MySatalites={G02, G03, G04, G05, G06, G07, G08, G09, G16, G27, G28, G30};
sat_paramets={G02 G03 G04 G05 G06 G07 G08 G09 G16 G27 G28 G30};
D={};
Satpositon={};
x0=0;
y0=0;
z0=0;
L=[];
A=[];

for i=1:length(MySatalites)
    D{i}=drm(calculation_epoch,Prn_c1(i,2),Relatedepoch_Clockcorrections{i},sat_paramets{i},R0rcv,ION_ALPHA,ION_BETA,sat_paramets{i}(6,3)); 
    Satpositon{i}=new_satpos(calculation_epoch,Prn_c1(i,2),Relatedepoch_Clockcorrections{i},sat_paramets{i},R0rcv);
    p0=sqrt((Satpositon{i}(1)-x0)^2+(Satpositon{i}(2)-y0)^2+(Satpositon{i}(3)-z0)^2); 
    L=[L;[Prn_c1(i,2)-p0-D{i}]];
    A=[A;[(x0-Satpositon{i}(1))/p0 (y0-Satpositon{i}(2))/p0 (z0-Satpositon{i}(3))/p0 1]];
    
end
X=((A'*A)^-1)*A'*L;
dx=X(1);
dy=X(2);
dz=X(3);
while  abs(dx)>10^-3 && abs(dy)>10^-3 && abs(dz)>10^-3
    x0=dx+x0;
    y0=dy+y0;
    z0=dz+z0;
    
    L=[];
    A=[];
       
    for i=1:length(MySatalites)
        p0=sqrt((Satpositon{i}(1)-x0)^2+(Satpositon{i}(2)-y0)^2+(Satpositon{i}(3)-z0)^2);  
        L=[L;[Prn_c1(i,2)-p0-D{i}]];
        A=[A;[(x0-Satpositon{i}(1))/p0 (y0-Satpositon{i}(2))/p0 (z0-Satpositon{i}(3))/p0 1]];        
    end
    X=((A'*A)^-1)*A'*L;
    dx=X(1);
    dy=X(2);
    dz=X(3);  
    
end
IGScor=[4239149.23905405 2886968.03012480 3778877.17820202];
Comparison=sqrt((x0-IGScor(1))^2+(y0-IGScor(2))^2+(z0-IGScor(3))^2);
disp(x0)
disp(y0)
disp(z0)
disp('--------------------------------')
disp(Comparison)
% disp(D)
% disp(Satpositon)